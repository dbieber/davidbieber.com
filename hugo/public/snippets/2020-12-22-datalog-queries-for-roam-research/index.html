<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="David Bieber">

  
  
  
    
  
  <meta name="description" content="Roam Research is an excellent note taking tool. One of its core features is &ldquo;back links&rdquo; &ndash; any of your notes can easily references any of your other notes, and so all your notes end up linked together in an intricate graph structure. You can quickly see all the references to a note, hence the term &ldquo;back link&rdquo;.
Roam exposes all of the information in your graph through a datalog API.">

  
  <link rel="alternate" hreflang="en-us" href="https://davidbieber.com/snippets/2020-12-22-datalog-queries-for-roam-research/">

  


  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-34570499-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-34570499-2', {});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu6034018d2bd3ec10a6270f0656007019_39811_32x32_fill_box_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu6034018d2bd3ec10a6270f0656007019_39811_192x192_fill_box_center_2.png">

  <link rel="canonical" href="https://davidbieber.com/snippets/2020-12-22-datalog-queries-for-roam-research/">

  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@Bieber">
  <meta property="twitter:creator" content="@Bieber">
  
  <meta property="og:site_name" content="David Bieber">
  <meta property="og:url" content="https://davidbieber.com/snippets/2020-12-22-datalog-queries-for-roam-research/">
  <meta property="og:title" content="Datalog Queries for Roam Research | David Bieber">
  <meta property="og:description" content="Roam Research is an excellent note taking tool. One of its core features is &ldquo;back links&rdquo; &ndash; any of your notes can easily references any of your other notes, and so all your notes end up linked together in an intricate graph structure. You can quickly see all the references to a note, hence the term &ldquo;back link&rdquo;.
Roam exposes all of the information in your graph through a datalog API."><meta property="og:image" content="img/map[gravatar:%!s(bool=true) shape:circle]">
  <meta property="twitter:image" content="img/map[gravatar:%!s(bool=true) shape:circle]"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-12-22T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2020-12-22T00:00:00&#43;00:00">
  

  



  


  


  





  <title>Datalog Queries for Roam Research | David Bieber</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">David Bieber</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">David Bieber</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/posts"><span>Writing</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/projects"><span>Projects</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      

      

    </ul>

  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">Datalog Queries for Roam Research</h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    
  </span>
  

  

  

  
  
  

  
  

</div>

  
</div>




  <div class="article-container">

    <div class="article-style" id="article-content">
      <p>
<a href="https://roamresearch.com/" target="_blank" rel="noopener">Roam Research</a> is an excellent note taking tool. One of its core features is &ldquo;back links&rdquo; &ndash; any of your notes can easily references any of your other notes, and so all your notes end up linked together in an intricate graph structure. You can quickly see all the references to a note, hence the term &ldquo;back link&rdquo;.</p>
<p>Roam exposes all of the information in your graph through a <strong>datalog API</strong>. Datalog is a declarative programming language that lets you make queries about your graph.</p>
<h2 id="resources">Resources</h2>
<p>If you want to learn datalog, I recommend <a href="http://www.learndatalogtoday.org/">http://www.learndatalogtoday.org/</a>. It teaches how to write datalog queries in 8 relatively short chapters chock full of examples.</p>
<p>If you want to see how to use datalog specifically for Roam, you can head over to <a href="https://www.putyourleftfoot.in/introduction-to-the-roam-alpha-api">https://www.putyourleftfoot.in/introduction-to-the-roam-alpha-api</a>. Or keep reading!</p>
<h2 id="examples">Examples</h2>
<p>In this snippet I include a number of examples of useful datalog queries for Roam Research.</p>
<h3 id="how-to-run-a-query">How to Run a Query</h3>
<p>Open the JavaScript console. Paste the query. Hit enter.</p>
<p>To open the JavaScript console in Chrome, hit cmd-option-J on Mac or Ctrl-shift-J on Windows. For other systems, 
<a href="https://www.google.com/search?q=how%20to%20open%20the%20javascript%20console" target="_blank" rel="noopener">you can look up how to open it</a>.</p>
<h3 id="pages-modified-today">Pages modified today</h3>
<p>This query returns a list of pages that have been modified today.</p>
<pre><code class="language-javascript">let ancestorrule=`[ 
   [ (ancestor ?b ?a) 
        [?a :block/children ?b] ] 
   [ (ancestor ?b ?a) 
        [?parent :block/children ?b ] 
        (ancestor ?parent ?a) ] ] ]`;

let references = window.roamAlphaAPI.q(`[
  :find ?title
  :in $ ?start_of_day %
  :where
  [?page :node/title ?title]
  (ancestor ?block ?page)
  [?block :edit/time ?time]
  [(&gt; ?time ?start_of_day)]
]`, new Date().setHours(0, 0, 0, 0), ancestorrule);

references.map(
  (data, index) =&gt; {return `${data[0]}`;})
.join('\n');
</code></pre>
<p>If you run it in the javascript console, it should print out a list of pages that have been modified today.</p>
<h3 id="references-to-a-specific-page">References to a specific page</h3>
<p>This query finds all blocks referencing a specific page. Replace &ldquo;Roam Research&rdquo; in the query with the name of the page that you want to find the references of.</p>
<pre><code class="language-javascript">let references = window.roamAlphaAPI.q(`[
  :find ?text
  :in $ ?title
  :where
  [?page :node/title ?title]
  [?e :block/refs ?page]
  [?e :block/string ?text]
]`, 'Roam Research');

references.map((data, index) =&gt; {return data[0];}).join('\n');
</code></pre>
<h3 id="all-blocks-on-a-specific-page">All blocks on a specific page</h3>
<p>This query finds all blocks on a specific page. Again replace &ldquo;Roam Research&rdquo; with the name of the page you&rsquo;re interested in.</p>
<pre><code class="language-javascript">let ancestorrule=`[ 
   [ (ancestor ?b ?a) 
        [?a :block/children ?b] ] 
   [ (ancestor ?b ?a) 
        [?parent :block/children ?b ] 
        (ancestor ?parent ?a) ] ] ]`;
let blocks = window.roamAlphaAPI.q(`[ 
  :find 
      ?string
  :in $ ?pagetitle % 
  :where 
      [?block :block/string ?string] 
      [?page :node/title ?pagetitle] 
      (ancestor ?block ?page)
  ]`, &quot;Roam Research&quot;, ancestorrule);

blocks.map((data, index) =&gt; {return data[0];}).join('\n');
</code></pre>
<h3 id="all-blocks-with-at-least-100-descendants">All blocks with at least 100 descendants</h3>
<p>This script finds all blocks with at least 100 descendants. The idea is that these blocks may have notes that are worth revisiting, either to summarize or reflect on. The threshold &ldquo;100&rdquo; is of course configurable at the top of the script.</p>
<pre><code class="language-javascript">let threshold = 100;
let ancestorrule=`[ 
   [ (ancestor ?child ?parent) 
        [?parent :block/children ?child] ]
   [ (ancestor ?child ?a) 
        [?parent :block/children ?child ] 
        (ancestor ?parent ?a) ] ] ]`;

let large_blocks = window.roamAlphaAPI.q(`
[:find ?ancestor (count ?block)
  :in $ % 
  :where 
    [?ancestor :block/string]
    [?block :block/string]
    (ancestor ?block ?ancestor)]
`, ancestorrule).filter((data, index) =&gt; {return data[1] &gt;= threshold});

let results = window.roamAlphaAPI.q(`[
  :find ?text ?uid ?childcount
  :in $ ?block ?childcount
  :where
  [?block :block/string ?text]
  [?block :block/uid ?uid]
]`, large_blocks)
  
results.map((data, index) =&gt; {return `((${data[1]})) (${data[2]})`}).join('\n');
</code></pre>
<h2 id="support-and-debugging">Support and Debugging</h2>
<p>The &ldquo;#querying&rdquo; channel on the 
<a href="https://roamresearch.slack.com/" target="_blank" rel="noopener">Roam Research Slack</a> is active and the community there is quite friendly. If you&rsquo;re crafting or debugging a query, that&rsquo;s a great place to ask for help or share your progress.</p>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/roam-research/">roam-research</a>
  
</div>










  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/snippets/2021-02-12-javascript-functions-for-inserting-blocks-in-roam/">JavaScript Functions for Inserting Blocks in Roam</a></li>
      
      <li><a href="/snippets/2021-01-04-more-datalog-queries-for-roam/">More Datalog Queries for Roam</a></li>
      
      <li><a href="/snippets/2020-12-28-publishing-blog-posts-from-roam-research-quickly-and-automatically/">Publishing Blog Posts from Roam Research Quickly and Automatically</a></li>
      
      <li><a href="/snippets/2020-12-27-even-faster-snippet-publishing-from-roam/">Even Faster Snippet Publishing from Roam</a></li>
      
    </ul>
  </div>
  












  
  





  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://davidbieber.com/">David Bieber</a></h5>
      
      
      <ul class="network-icon" aria-hidden="true">
  
</ul>

    </div>
  </div>








  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/javascript.min.js"></script>
        
      

    

    
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    

    <script crossorigin src="//unpkg.com/react@16/umd/react.production.min.js"></script>
<script crossorigin src="//unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>

<script src="/js/academic.min.c816d323c3a55093dae0829b44ea1ca8.js"></script>

<script src="//code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="//static.tumblr.com/fpifyru/AKFlv9zdu/embedgist.js"></script>


<script src="//www.gstatic.com/firebasejs/7.6.2/firebase-app.js"></script>
<script src="//www.gstatic.com/firebasejs/7.6.2/firebase-analytics.js"></script>
<script src="//www.gstatic.com/firebasejs/7.6.2/firebase-firestore.js"></script>

<script>
  var firebaseConfig = {
    apiKey: "AIzaSyDZSDKaAmz-UUyaL1IZMi4QO_q4Jouko2c",
    authDomain: "ask-me-anywhere.firebaseapp.com",
    databaseURL: "https://ask-me-anywhere.firebaseio.com",
    projectId: "ask-me-anywhere",
    storageBucket: "ask-me-anywhere.appspot.com",
    messagingSenderId: "123038093749",
    appId: "1:123038093749:web:e8ce89651fcf1371d109fc",
    measurementId: "G-JLDGL73R1B"
  };
  
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
</script>

    



  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    

    

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
