<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="David Bieber">

  
  
  
    
  
  <meta name="description" content="OAuth2 is confusing. I&rsquo;ve set it up several times before, and each time I encounter it it&rsquo;s a bit of a mental mess to wrap my mind around it again.
So, this time, as I set up OAuth2 to let Bieber Bot interact with more Slack workspaces, I will write up my renewed understanding of OAuth2 in the hope that next time I have to set up OAuth2, it&rsquo;s a little easier.">

  
  <link rel="alternate" hreflang="en-us" href="https://davidbieber.com/snippets/2020-03-20-understanding-oauth2/">

  


  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-34570499-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-34570499-2', {});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu6034018d2bd3ec10a6270f0656007019_39811_32x32_fill_box_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu6034018d2bd3ec10a6270f0656007019_39811_192x192_fill_box_center_2.png">

  <link rel="canonical" href="https://davidbieber.com/snippets/2020-03-20-understanding-oauth2/">

  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@Bieber">
  <meta property="twitter:creator" content="@Bieber">
  
  <meta property="og:site_name" content="David Bieber">
  <meta property="og:url" content="https://davidbieber.com/snippets/2020-03-20-understanding-oauth2/">
  <meta property="og:title" content="Understanding OAuth2 | David Bieber">
  <meta property="og:description" content="OAuth2 is confusing. I&rsquo;ve set it up several times before, and each time I encounter it it&rsquo;s a bit of a mental mess to wrap my mind around it again.
So, this time, as I set up OAuth2 to let Bieber Bot interact with more Slack workspaces, I will write up my renewed understanding of OAuth2 in the hope that next time I have to set up OAuth2, it&rsquo;s a little easier."><meta property="og:image" content="img/map[gravatar:%!s(bool=true) shape:circle]">
  <meta property="twitter:image" content="img/map[gravatar:%!s(bool=true) shape:circle]"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-03-20T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2020-03-20T00:00:00&#43;00:00">
  

  



  


  


  





  <title>Understanding OAuth2 | David Bieber</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">David Bieber</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">David Bieber</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/posts"><span>Writing</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/projects"><span>Projects</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      

      

    </ul>

  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">Understanding OAuth2</h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    
  </span>
  

  

  

  
  
  

  
  

</div>

  
</div>




  <div class="article-container">

    <div class="article-style" id="article-content">
      <p>
<a href="https://oauth.net/2/" target="_blank" rel="noopener">OAuth2</a> is confusing. I&rsquo;ve set it up several times before, and each time I encounter it it&rsquo;s a bit of a mental mess to wrap my mind around it again.</p>
<p>So, this time, as I set up OAuth2 to let 
<a href="/projects/bieber-bot">Bieber Bot</a> interact with more Slack workspaces, I will write up my renewed understanding of OAuth2 in the hope that next time I have to set up OAuth2, it&rsquo;s a little easier.</p>
<h2 id="overview-of-the-oauth2-flow">Overview of the OAuth2 Flow</h2>
<p>How does the OAuth2 flow go? Like this:</p>
<p>The user wants to add Bieber Bot to a Slack channel. So, they&rsquo;re on my website 
<a href="https://davidbieber.com/" target="_blank" rel="noopener">(davidbieber.com)</a> and they click the <em>Add to Slack</em> button. This takes them to Slack, with GET parameters that indicate they want to add Bieber Bot to some Slack workspace. The workspace id can be part of the URL of the Add to Slack button, but even if it&rsquo;s not, Slack will do the right thing and just ask the user to choose one of their workspaces. If the user isn&rsquo;t already logged in to Slack, they&rsquo;ll be prompted to do so at this point.</p>
<p>After the user clicks the <em>Add to Slack</em> button they are taken to Slack, where they are shown the list of OAuth2 scopes that Bieber Bot is requesting. If they approve giving Bieber Bot the permissions listed in the scopes, they are taken to a <em>redirect url</em> that I, the developer of Bieber Bot, have specified. I have both pre-informed Slack of the redirect URLs I might use, and I have included a specific redirect URL in the link on the <em>Add to Slack</em> button. When the user is redirected to this redirect url, two GET parameters are included. The first is a <code>code</code>, which my server can use to get an Access Token / Bearer Token. The second is a <code>state</code> which is something that I, the developer, can include on the original link from the <em>Add to Slack</em> button in order to make sure the request I&rsquo;m getting at the redirect URL is genuine.</p>
<p>When the redirect URL is accessed with a <code>code</code> GET parameter, it then turns around and uses that <code>code</code> to request an Access Token from Slack. Once it has that Access Token, it tucks it away. It can use that access token in order to perform any of the permissions granted by the user during the access flow.</p>
<p>Usually using the Access Token takes the form of issuing post requests to Slack with the Access Token as a parameter.</p>
<p>The user can revoke access to Bieber Bot at any time. Once they do so, the Access Token becomes invalid. If Bieber Bot tries to use the Access Token at that point, it will get an error. The user will have to give Bieber Bot permissions again, and it will get a new access token, in order for it to continue providing its services and companionship.</p>
<h2 id="summary-of-the-the-important-bits">Summary of the the Important Bits</h2>
<ol>
<li>User navigates from website to service (e.g. via <em>Add to Slack</em> button).</li>
<li>Service shows user permissions dialog.</li>
<li>Upon accepting permissions, service redirects user back to website&rsquo;s redirect URL with <code>code</code></li>
<li>Website uses <code>code</code> to get Access Token</li>
<li>Website uses Access Token to do the stuff allowed by the permissions granted by the user</li>
</ol>
<h2 id="summary-of-the-less-important-bits">Summary of the Less Important Bits</h2>
<ol>
<li>
<p>The <em>Add to Slack</em> button should include GET parameters for: a) <code>state</code> so the redirect url knows the request is genuine, b) <code>redirect_url</code> so Slack knows where to send the user after they accept the permissons, c) <code>scope</code> indicating the permissions being requested, d) <code>client_id</code> indicating the app (e.g. Bieber Bot) that you&rsquo;re adding to Slack.</p>
</li>
<li>
<p>The permissions that the App can request are set up by the App ahead of time. So I think the <code>scope</code> parameter is there if you only need to request a subset of that permissions for a particular user.</p>
</li>
<li>
<p>The full list of possible redirect URLs should be set up ahead of time. Then when you generate the <em>Add to Slack</em> button, you just choose a particular redirect URL that Slack should redirect the user to after they accept the permissions. Why would you want more than one redirect URL? Well, one might be for staging, one for production, and one for local development.</p>
</li>
<li>
<p>The redirect URL receives both the <code>code</code> and <code>state</code> GET parameters. The website creating the <em>Add to Slack</em> button decides on the state. It can then check that the state is there in the redirect URL. This prevents users from going directly to Slack without going through the website, because if they try to do that, they won&rsquo;t have the state and will fail the check at the redirect URL. This is useful if you want to restrict installs for your App to specific customers, e.g. those who&rsquo;ve solved a puzzle, or paid.</p>
</li>
</ol>
<h2 id="what-is-this">What is this?</h2>
<p>This certainly isn&rsquo;t meant to be an OAuth2 guide at all. By writing this out, I think I&rsquo;ve helped myself understand the OAuth2 flow better though. That&rsquo;s really what snippets are all about.</p>

    </div>

    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/tech-tips/">tech-tips</a>
  
</div>










  
  
  
  

<div class="article-widget content-widget-hr">
  <details id="chat-details">
    <summary><h3>Discussion 💬</h3></summary>
    
    <widgetbot
      server="695290335823265862"
      channel=988521648015687762
      width="100%"
      height="600">
    </widgetbot>
  </details>
</div>

<script>
let chatLoaded = false;
const details = document.querySelector('#chat-details');
details.addEventListener("toggle", event => {
  if (details.open && !chatLoaded) {
    const script = document.createElement('script');
    script.src = "https://cdn.jsdelivr.net/npm/@widgetbot/html-embed";
    document.head.appendChild(script);
    chatLoaded = true;
  }
});
</script>




  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/snippets/2020-12-02-supervisord/">Supervisord</a></li>
      
      <li><a href="/snippets/2020-10-03-checking-your-fan-speed-and-cpu-temperature-on-mac-os/">Checking Your Fan Speed and CPU Temperature on Mac OS (2020)</a></li>
      
      <li><a href="/snippets/2020-04-11-tips-for-obs/">Tips for Effective OBS</a></li>
      
      <li><a href="/snippets/2022-07-21-twitter-oauth-login/">Logging into a Twitter App with OAuth</a></li>
      
    </ul>
  </div>
  












  
  





  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://davidbieber.com/">David Bieber</a></h5>
      
      
      <ul class="network-icon" aria-hidden="true">
  
</ul>

    </div>
  </div>








  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/javascript.min.js"></script>
        
      

    

    
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    

    <script crossorigin src="//unpkg.com/react@16/umd/react.production.min.js"></script>
<script crossorigin src="//unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>

<script src="/js/academic.min.c816d323c3a55093dae0829b44ea1ca8.js"></script>

<script src="//code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="//static.tumblr.com/fpifyru/AKFlv9zdu/embedgist.js"></script>


<script src="//www.gstatic.com/firebasejs/7.6.2/firebase-app.js"></script>
<script src="//www.gstatic.com/firebasejs/7.6.2/firebase-analytics.js"></script>
<script src="//www.gstatic.com/firebasejs/7.6.2/firebase-firestore.js"></script>

<script>
  var firebaseConfig = {
    apiKey: "AIzaSyDZSDKaAmz-UUyaL1IZMi4QO_q4Jouko2c",
    authDomain: "ask-me-anywhere.firebaseapp.com",
    databaseURL: "https://ask-me-anywhere.firebaseio.com",
    projectId: "ask-me-anywhere",
    storageBucket: "ask-me-anywhere.appspot.com",
    messagingSenderId: "123038093749",
    appId: "1:123038093749:web:e8ce89651fcf1371d109fc",
    measurementId: "G-JLDGL73R1B"
  };
  
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
</script>

    



  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    

    

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
